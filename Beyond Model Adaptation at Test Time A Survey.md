测试时适应：仅在源域数据上训练模型，并在测试时推理过程中使其适应目标域数据集
在该范式中，训练时只能访问源分布 $S$，测试时只能访问来自目标分布的未标注数据 $x_t$ 

### 问题背景
分布偏移的四种常见类型：
1. 协变量偏移：$p(x_t)\neq p(x_s), p(y_t|x_t)=p(y_s|x_s)$  
   源域和目标域输入的边缘分布不同，但条件分布相同
   源域中均为现实拍摄的照片，而目标域中均为卡通图片，所以输入的边缘分布不同
   不论对于源域还是目标域，给定狗的图片，输出的标签都要是狗，学习的任务是相同的
   解决方法：学习域不变的特征表示，无论对于源域还是目标域的狗，都要输出狗的标签

2. 标签偏移：$p(y_t)\neq p(y_s), p(x_t|y_t)=p(x_s|y_s)$
   源域和目标域的标签分布不同，但是条件分布相同
   源域中狗和马的图片的数量比为 9:1，而目标域中狗和马的图片的数量比为 1:1，所以标签分布不同
   但是无论源域还是目标域，狗和马均为现实拍摄的照片，因此输入的边缘分布是相同的。从而，只要确定这个样本是只狗时，其表征不会因为在源域还是目标域而有所变化，所以的条件分布是相同的

3. 概念偏移：$p(x_t)= p(x_s), p(y_t|x_t)\neq p(y_s|x_s)\,X\rightarrow Y$
		    $p(y_t)= p(y_s), p(x_t|y_t)\neq p(x_s|y_s)\,Y\rightarrow X$
   概念偏移不同于协变量偏移和标签偏移，它与数据分布或类别分布无关，而是与两个变量之间的关系有关
   假设研究2008年金融危机前各公司的利润，并建立了一个算法，根据行业、员工人数、产品信息等因素来预测利润。如果算法是用2000年至2007年的数据训练的，却没有用它来预测金融危机后的相同信息，那么它的表现很可能不佳
   那么，究竟发生了什么变化？显然，由于新的社会经济环境，投入和产出之间的整体关系发生了改变。如果变量没有反映出这些变化（例如，没有设置一个虚拟变量来表示金融危机发生的日期，也没有使用危机发生日期前后的训练数据），那么模型就会受到概念转移的影响

4. 条件偏移：$p(y_t)= p(y_s), p(x_t|y_t)\neq p(x_s|y_s)$
   源域和目标域的标签分布相同，但是条件分布不同
   源域中狗和马的图片的数量比为 1:1，目标域中狗和马的图片的数量比也为 1:1，所以标签分布不同
   源域中均为现实拍摄的照片，而目标域中均为卡通图片，所以条件分布不同
   
模型参数 $\theta_s$ 、目标域数据 $x_t$、大模型的提示词都可以作为适应对象。当前的测试时适应方法适应这些组件中的每一个或它们的组合。测试时适应是与推理一起以在线或批量方式实现的，而无需在每个测试步骤访问大量目标域数据。

- 域适应，训练期间可以访问目标数据的假设在实际应用中通常是无效的 $\longrightarrow$ 
- 域泛化，训练期间仅使用源数据，训练好的模型直接部署在目标域上而不考虑目标信息 $\longrightarrow$ 
- 无源域适应，避免在训练期间访问目标数据，同时考虑目标信息以实现分布偏移的良好泛化 $\longrightarrow$ 
- 测试时适应，适应在推理期间或与推理一起实现，避免了推理前迭代模型微调的额外自适应过程

基于现有方法的适应对象划分五个类别：模型、推理、归一化、样本和提示

### 模型适应
大多数模型适应方法通过目标测试数据上的无监督损失来微调模型参数来调整其源训练模型
根据无监督损失函数继续划分
#### 辅助自监督
Test-Time Training with Self-Supervision  for Generalization under Distribution Shifts
Test-time Unsupervised Domain Adaptation